# å‰ç«¯ä¸åç«¯è¿æ¥æµ‹è¯•æŒ‡å—

## ğŸš€ å¿«é€Ÿæµ‹è¯•æ­¥éª¤

### 1. åç«¯æœåŠ¡çŠ¶æ€æ£€æŸ¥
```bash
# æ£€æŸ¥ç«¯å£æ˜¯å¦è¢«å ç”¨
netstat -an | findstr :8000

# å¦‚æœç«¯å£è¢«å ç”¨ï¼Œé‡å¯åç«¯æœåŠ¡
python -m app.main
```

### 2. åŸºç¡€è¿æ¥æµ‹è¯•
```bash
# è¿è¡Œè¿æ¥æµ‹è¯•
python test_frontend_connection.py
```

### 3. æ‰‹åŠ¨æµ‹è¯•API
```bash
# å¥åº·æ£€æŸ¥
curl http://127.0.0.1:8000/

# æµ‹è¯•CORSï¼ˆéœ€è¦é‡å¯æœåŠ¡å™¨åç”Ÿæ•ˆï¼‰
curl -H "Origin: http://localhost:3000" http://127.0.0.1:8000/
```

## ğŸ”§ å‰ç«¯é›†æˆä»£ç 

### JavaScript/TypeScript ç¤ºä¾‹
```javascript
const API_BASE_URL = 'http://127.0.0.1:8000';

// 1. å¥åº·æ£€æŸ¥
async function checkBackend() {
    try {
        const response = await fetch(`${API_BASE_URL}/`);
        const data = await response.json();
        console.log('åç«¯çŠ¶æ€:', data);
        return true;
    } catch (error) {
        console.error('åç«¯è¿æ¥å¤±è´¥:', error);
        return false;
    }
}

// 2. ä¸Šä¼ å¹¶å¤„ç†å›¾ç‰‡
async function processImages(queryFile, gerberFile) {
    const formData = new FormData();
    formData.append('query', queryFile);
    formData.append('gerber', gerberFile);
    formData.append('model', '256');
    
    try {
        const response = await fetch(`${API_BASE_URL}/api/process`, {
            method: 'POST',
            body: formData
        });
        
        if (response.ok) {
            const result = await response.json();
            console.log('å¤„ç†ç»“æœ:', result);
            return result;
        } else {
            throw new Error(`HTTP ${response.status}: ${await response.text()}`);
        }
    } catch (error) {
        console.error('å¤„ç†å¤±è´¥:', error);
        throw error;
    }
}

// 3. æ˜¾ç¤ºè¿”å›çš„å›¾ç‰‡
function displayResultImages(result) {
    // æ˜¾ç¤ºè½¬æ¢åçš„Gerberå›¾
    if (result.convertedGerber) {
        const img1 = document.createElement('img');
        img1.src = `data:image/png;base64,${result.convertedGerber}`;
        img1.style.maxWidth = '300px';
        document.body.appendChild(img1);
    }
    
    // æ˜¾ç¤ºå¼‚å¸¸æ£€æµ‹å›¾
    if (result.anomalyImage) {
        const img2 = document.createElement('img');
        img2.src = `data:image/png;base64,${result.anomalyImage}`;
        img2.style.maxWidth = '300px';
        document.body.appendChild(img2);
    }
}
```

### React ç¤ºä¾‹
```jsx
import React, { useState } from 'react';

function ImageProcessor() {
    const [result, setResult] = useState(null);
    const [loading, setLoading] = useState(false);

    const handleFileUpload = async (queryFile, gerberFile) => {
        setLoading(true);
        try {
            const formData = new FormData();
            formData.append('query', queryFile);
            formData.append('gerber', gerberFile);
            formData.append('model', '256');

            const response = await fetch('http://127.0.0.1:8000/api/process', {
                method: 'POST',
                body: formData
            });

            if (response.ok) {
                const data = await response.json();
                setResult(data);
            } else {
                throw new Error(`å¤„ç†å¤±è´¥: ${response.status}`);
            }
        } catch (error) {
            console.error('ä¸Šä¼ å¤±è´¥:', error);
        } finally {
            setLoading(false);
        }
    };

    return (
        <div>
            {loading && <p>å¤„ç†ä¸­...</p>}
            {result && (
                <div>
                    <p>å¼‚å¸¸åˆ†æ•°: {result.anomalyScore}</p>
                    <p>ç¼ºé™·æè¿°: {result.defectDescription}</p>
                    {result.convertedGerber && (
                        <img src={`data:image/png;base64,${result.convertedGerber}`} alt="è½¬æ¢åå›¾ç‰‡" />
                    )}
                    {result.anomalyImage && (
                        <img src={`data:image/png;base64,${result.anomalyImage}`} alt="å¼‚å¸¸æ£€æµ‹å›¾" />
                    )}
                </div>
            )}
        </div>
    );
}
```

## ğŸ› å¸¸è§é—®é¢˜è§£å†³

### 1. CORS é”™è¯¯
**é—®é¢˜**: `Access to fetch at 'http://127.0.0.1:8000' from origin 'http://localhost:3000' has been blocked by CORS policy`

**è§£å†³**: 
- é‡å¯åç«¯æœåŠ¡å™¨
- æ£€æŸ¥ `app/main.py` ä¸­çš„ CORS é…ç½®
- ç¡®ä¿ `CORSMiddleware` æ­£ç¡®æ·»åŠ 

### 2. è¿æ¥è¢«æ‹’ç»
**é—®é¢˜**: `Failed to fetch` æˆ– `Connection refused`

**è§£å†³**:
- æ£€æŸ¥åç«¯æœåŠ¡æ˜¯å¦è¿è¡Œ: `netstat -an | findstr :8000`
- é‡å¯åç«¯æœåŠ¡: `python -m app.main`
- æ£€æŸ¥é˜²ç«å¢™è®¾ç½®

### 3. æ–‡ä»¶ä¸Šä¼ å¤±è´¥
**é—®é¢˜**: `422 Unprocessable Entity`

**è§£å†³**:
- ç¡®ä¿æ–‡ä»¶æ ¼å¼æ­£ç¡® (PNG, JPG, JPEG)
- æ£€æŸ¥æ–‡ä»¶å¤§å°é™åˆ¶ (10MB)
- ç¡®ä¿ FormData å­—æ®µåæ­£ç¡®: `query`, `gerber`

## ğŸ“Š æµ‹è¯•ç»“æœéªŒè¯

### æˆåŠŸçš„å“åº”ç¤ºä¾‹
```json
{
    "convertedGerber": "iVBORw0KGgoAAAANSUhEUgAA...", // base64å›¾ç‰‡
    "anomalyImage": "iVBORw0KGgoAAAANSUhEUgAA...",   // base64å›¾ç‰‡
    "anomalyScore": 0.48133617639541626,
    "defectDescription": "è½»å¾®ç¼ºé™·ï¼ˆç½®ä¿¡åº¦: 48.1%ï¼‰ï¼šå»ºè®®å®šæœŸæ£€æŸ¥"
}
```

### æµ‹è¯•æ£€æŸ¥æ¸…å•
- [ ] åç«¯æœåŠ¡è¿è¡Œæ­£å¸¸ (ç«¯å£8000)
- [ ] å¥åº·æ£€æŸ¥è¿”å›200çŠ¶æ€ç 
- [ ] CORSå¤´ä¿¡æ¯æ­£ç¡®è¿”å›
- [ ] å›¾ç‰‡ä¸Šä¼ æ¥å£å“åº”æ­£å¸¸
- [ ] å›¾ç‰‡å¤„ç†æ¥å£è¿”å›ç»“æœ
- [ ] è¿”å›çš„å›¾ç‰‡å¯ä»¥æ­£ç¡®æ˜¾ç¤º

## ğŸš€ éƒ¨ç½²å»ºè®®

### å¼€å‘ç¯å¢ƒ
- åç«¯: `http://127.0.0.1:8000`
- å‰ç«¯: `http://localhost:3000` (React) æˆ– `http://localhost:5173` (Vite)

### ç”Ÿäº§ç¯å¢ƒ
- ä¿®æ”¹ `app/main.py` ä¸­çš„ CORS é…ç½®ï¼ŒæŒ‡å®šå…·ä½“çš„å‰ç«¯åŸŸå
- ä½¿ç”¨ç¯å¢ƒå˜é‡ç®¡ç†APIåœ°å€
- è€ƒè™‘ä½¿ç”¨åå‘ä»£ç† (Nginx) å¤„ç†è·¨åŸŸ
